# Описание
## Описание проблемы
Для каждого проекта аналитик ведет отдельную таблицу с информацией о затраченных дополнительных часах на выполнение строительно-монтажных работ. Каждый месяц он запрашивает подписанные отчеты (ВЛР) у субподрядчика и добавляет данные из них к ранее собранным. Так получается накопитель где можно посмотреть информацию о затраченных дополнительных часах за весь период строительства. 
Одним из важных отчетов в компании является показатель эффективности. Он рассчитвается как отношение фактических часов к нормативным. Чтобы рассчитать этот показатель аналитик запрашивает табельные и нормативные часы субподрядной организации. Эти часы показывают полное время на выполнение проектных и доплнительных работ. Путем вычитания из этих значений дополнительных часов аналитик получает затраченные на проектные работы часы: 1к - фактические, 1н - нормативные. Существующая методика рассчета подразумевает, что эти показатели хранятся совместно с дополнительными часами. Это приводит к сложности в формировании отчетов по дополнительным часам так как требуется в фильтре убирать показатели 1к, 1н.
Другой задачей аналитика является формирование укрупненных отчетов по понесенных трудозатрам. Эти отчеты строятся в разрезах дисциплин строительных работ: разработка грунта, заливка фундаментов, сооружение металлоконструкий и тд. Данные в таблице представляют собой краткое описание выполненной за день работы с колчеством затраченных на нее часов. Для того, чтобы получить укрупненный отчет необходимо предварительно присвоить каждой работе унифицированный код работы (типовая позиция). Каждому коду работы присвоены уровни укрупнения. Эта информация хранится в отдельном справочнике типовых позиций. Соответственно, чтобы получить укрепненный отчет требуется предварительно свести данные. Только после этого можно сгруппировать данные по требуемому уровню и рассчитать для каждой группы суммарное количество затраченных часов.
Ранее было сказано, что для каждого проекта ведется отдельный файл с дополнительными часами. Аналитик регулярно использует его для просмотра детальной информации по проекту в разрезе дисциплин и месяцев это удобно. При этом для руководства важно иметь перед глазами общий свод по всем проектам. Как же такой отчет получить? Для этого надо сначала в каждом из файлов рассчитать сводные показатели для проекта, а потом свести все эти данные в единую таблицу. Сейчас эту информацию ежемесячно собирает отдельно выделенный аналитик и публикует в google sheets. Если данные по любому из проектов меняются аналитик обязан уведомить об этом и внести корректировки. Естественно, при таком подходе нередки ошибки.
## Решение
Для решения задачи используем инструмент Power Query от Microsoft. С его помощью объеденияем данные из проектов в единую таблицу и обогащаем их информацией из справочника. Из справочника берутся уровни типовых позиций, инифицированное название проетов, организаций и тд. Для того, чтобы с данными было удобно работать они делятся на две таблицы: с дополнительными часами и показателями 1к, 1н. Эти данные служат источником для отчета по проектам в Power BI и других отчетов в которых используются дополнительные часы.
## Требования
- Microsoft Excel 2019 и выше
## Источники
- папка с файлами баз дополнительных часов по проектам, формата xlsx
- справочник(схема)
## Является источником для
- отчет Power BI
- модель
## Аттрибуты источника
- дата, месяц выполнения работы в формате даты (обычно используется начало месяца), текст
- проект, название проекта по справочнику, текст
- подпроект, название подпроекта по справочнику, текст
- организация, название организации по справочнику, текст
- классификатор, классификатор работы, текст
- работа описание, описание выполненной работы, текст
- работа группа, шифр дисциплины выполненной работы, текст
- типовые, шифр кода типовой работы по справочнику, текст
- часы, затраченные людские ресурсы выраженные в часах, число
- стоимость руб, стоиомтсь работы в рублях, число
## Аттрибуты базы
- дата
- схема.год, год выполнения работы, берется из справочника по дате, текст
- схема.месяц год и месяц выполнения работы, берется из справочника по дате, текст
- проект
- подпроект
- проект_key, ключ проекта, объединение проекта и подпроекта [проект & "_" & подпроект], текст
- схема.проект, название проекта из справочника, берется по ключу проект_key
- схема.подпроект, название подпроекта из справочника, берется по ключц проект_key
- организация
- организация_key
- схема.организация
- классификатор
- классификатор_key
- схема.классификатор с описанием
- работа описание
- работа группа
- типовые
- типовые_key
- схема.типовые наименование
- схема.типовые ур0 наименование
- схема.типовые ур1 наименование
- схема.типовые ур2 наименование
- часы
- стоимость руб
- имя файла
*позиции без описания - аттрибуты источника*
## Основные операции Power Query
- Начал описывать основные операции power query
- Добавил новые описания
- Еще одни описания
## Метрики отчета
